{% extends "portail/page.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load static %}
{% load embed %}

{% block styles %}
{{ block.super }} <style>
.box-soustitre {
font-family: Arial, sans-serif;
font-weight: bold;
font-size: 1.2rem;
color: #000;
margin-bottom: 0.5rem;
}
.message-box {
padding: 0.5rem 1rem;
}
.message-title i {
margin-right: 5px;
font-size: 1.4rem;
font-weight: bold;
}
.message-preview {
font-size: 0.9rem;
margin: 0;
}
.message-meta {
font-size: 0.75rem;
color: #6c757d;
} </style>
{% endblock %}

{% block contenu_page %}

<div class="row">
    <div class="col-md-12">

    <div class="text-center mb-4">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#nouvelleConversationModal">
            Nouvelle conversation
        </button>
    </div>

    {# Messages non lus #}
    {% embed 'core/box.html' with box_titre=True %}
        {% block box_theme %}card-outline card-lightblue{% endblock %}
        {% block box_titre %}Messages non lus{% endblock %}
        {% block box_soustitre %}<div class="box-soustitre">Derniers messages reçus</div>{% endblock %}
        {% block card_body_classe %}p-0{% endblock %}
        {% block box_contenu %}
            {% if liste_messages_non_lus %}
                {% for message in liste_messages_non_lus %}
                    <div class="message-box {% if message.structure == structure %}bg-primary{% endif %}">
                        <a href="{% url 'portail_messagerie' idstructure=message.structure_id %}">
                            <div class="message-title">
                                <i class="fa fa-envelope text-danger"></i> <strong>{{ message.structure.nom }}</strong>
                            </div>
                            <p class="message-preview">{{ message.texte|striptags|truncatechars:50 }}</p>
                            <p class="message-meta">
                                <i class="fa fa-clock-o"></i> {{ message.date_creation|timesince }}
                            </p>
                        </a>
                    </div>
                    <hr class="m-0">
                {% endfor %}
            {% else %}
                <div class="p-2 text-success">Aucun message non lu</div>
            {% endif %}
        {% endblock box_contenu %}
    {% endembed %}

    {# Messages lus #}
    {% embed 'core/box.html' with box_titre=True %}
        {% block box_theme %}card-outline card-lightblue{% endblock %}
        {% block box_titre %}Conversations en cours{% endblock %}
        {% block box_soustitre %}<div class="box-soustitre">Messages lus récemment</div>{% endblock %}
        {% block card_body_classe %}p-0{% endblock %}
        {% block box_contenu %}
            {% if liste_messages_lus %}
                {% for message in liste_messages_lus %}
                    <div class="message-box {% if message.structure == structure %}bg-primary{% endif %}">
                        <a href="{% url 'portail_messagerie' idstructure=message.structure_id %}">
                            <div class="message-title">
                                <i class="fa fa-envelope-open text-success"></i> <strong>{{ message.structure.nom }}</strong>
                            </div>
                            <p class="message-preview">{{ message.texte|striptags|truncatechars:50 }}</p>
                            <p class="message-meta">
                                <i class="fa fa-clock-o"></i> {{ message.date_creation|timesince }}
                            </p>
                        </a>
                    </div>
                    <hr class="m-0">
                {% endfor %}
            {% else %}
                <div class="p-2 text-muted">Aucun message lu récent</div>
            {% endif %}
        {% endblock box_contenu %}
    {% endembed %}

</div>
</div>

{% endblock contenu_page %}
